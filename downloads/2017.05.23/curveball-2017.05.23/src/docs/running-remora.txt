REMORA USER GUIDE - version 2017.05.23 

Introduction
============

Many web pages commonly reference additional content. Using a conventional
web browser, a client that visits such a web page causes a burst of subsequent
connections, often to third parties, in order to fetch images, load modular
content, profile users, etc. A Curveball connection does not currently simulate
this burst of activity. The absence of a burst of connections provides a means
of detecting the use of Curveball.

Remora is a first step in addressing this complex issue. Remora builds a model
of connection patterns by observing authentic traffic generated by a client
using an off-the-shelf web browser. This traffic model is then used by Remora
to aid Curveball users in creating connections that blend in with or mimic
third-party connections and are undetectable by the adversary.

Remora Components
=================

The Remora software consists of two components:

- remora-server

    The Remora server observes all outbound HTTP/HTTPS connections on a
    specified network interface, and builds a traffic model with estimated
    connection relationships and dependencies. It then answers queries
    about the creation of connections (i.e., timing and other connection
    attributes) such that they blend in with observed traffic patterns.

- remora-client

    The Remora client connects to the Remora server, and does a single
    query for a host/protocol to use.

    Most applications that want to use Remora will use the Remora
    server API directly, but remora-client is provided as a way to
    access the server via the shell.

Running Remora
==============

These instructions assume that the BBN Curveball software has been
installed and is running and ready for a BBN Curveball connection to be
initiated.

1.  On the client host, start the Remora server.

	sudo /opt/curveball/scripts/remora-server [OPTIONS]

    OPTIONS:

	-p PORT, --port=PORT

	    The listening port of the server. The default port is 4003.
            Note that if the server uses a port other than the default,
            the Remora client MUST be configured to use the same port.

	-i INTERFACE, --interface=INTERFACE

	    The network interface on which the server observes packets.
            This should be the interface over which Curveball connections
            are to be initiated. The default interface is 'eth0'.

	    Note that the default interface is often incorrect on
	    DETER (because the client will have multiple interfaces)
	    and may be different from experiment to experiment.

    By default, remora-server loads host/protocol whitelists and
    blacklists (lists of host/protocol combinations that have worked
    as decoys in the past, or not worked as decoys in the past) from
    files remora-whitelist.txt and remora-blacklist.txt in the directory
    where the remora-server script was found, if these files
    exist.  The remora-server also loads the previous state of its
    models when it starts, and saves it when it exits, to remora-state.p
    in the same directory.  These filenames can be overridden via the
    -w, -b, and -s parameters.

    NOTE: Where and how the Remora state is saved is likely to change
    in future releases.


    NOTE: To stop the Remora server, use the following command on the client.

	    sudo /opt/curveball/scripts/remora-shutdown

	This is required to break out of the pcap_loop() call used by the
	Remora server. A better solution may be used in the future.

2.  On the client host, start the BBN Curveball client.

	sudo curveball-client [OPTIONS] -r

    NOTE: the other options to curveball-client (i.e., "-x") are still
    required.  The "-r" flag ONLY overrides the use of the -d and -w
    options.

    The '-r' (or '--remora') command-line option runs the client in Remora
    mode. The client is not run in Remora mode by default; it must be
    explicitly turned on by using this option.

    The '--remora-port' command-line option is also available to configure the
    port on which to connect to the Remora server. The default port is 4003.

    See the documentation included with BBN Curveball for a list and
    explanation of all other curveball-client options.

    In Remora mode, the BBN Curveball client first queries the Remora server
    prior to initiating a Curveball connection. The Remora server responds
    when it determines that a Curveball connection should be initiated.  A
    Curveball connection is then created by the client using the suggested
    specifications, e.g., decoy address and port, provided by the server.

    NOTE: In the current implementation of curveball-client, if Remora
    chooses a TLS connection then -u, if present, is implicitly removed
    from the command line, and if Remora chooses an HTTP connection then
    -u is implicitly added.

Notes
=====

(0) It is recommended that the user not use a proxy or VAN when running Remora.


ACKNOWLEDGMENTS

This product includes software developed in part by support from the Defense
Advanced Research Project Agency (DARPA) Contract No. N66001-11-C-4017. 
